import email
from email import policy
from email.parser import BytesParser
import dns.resolver
import extract_msg

def get_mx_records(domain):
    try:
        mx_records = dns.resolver.resolve(domain, 'MX')
        return [str(record.exchange) for record in mx_records]
    except (dns.resolver.NoAnswer, dns.resolver.NXDOMAIN):
        return None  # Если MX-записи не найдены
    except Exception as e:
        print(f"Ошибка при получении MX-записей для {domain}: {e}")
        return None

def parse_email_headers(msg_file):
    if msg_file.endswith('.msg'):
        # Извлечение данных из .msg файла
        msg = extract_msg.Message(msg_file)
        headers = {
            'From': msg.sender,
            'To': msg.to,
            'Subject': msg.subject,
            'Date': msg.date,
            'Message-ID': msg.message_id,
            'Return-Path': msg.return_path,
            'Received': msg.received,
        }
    else:
        # Открываем файл с письмом в формате .eml
        with open(msg_file, 'rb') as f:
            msg = BytesParser(policy=policy.default).parse(f)
            headers = {
                'From': msg['From'],
                'To': msg['To'],
                'Subject': msg['Subject'],
                'Date': msg['Date'],
                'Message-ID': msg['Message-ID'],
                'Return-Path': msg['Return-Path'],
                'Received': msg.get_all('Received'),
            }

    # Извлекаем информацию о 'Received: from'
    received_from = []
    if headers.get('Received'):
        for received in headers['Received']:
            if 'from' in received:
                domain = received.split('from ')[1].split(' ')[0]
                received_from.append(domain)

                # Получение MX-записей для домена
                mx_records = get_mx_records(domain)
                if mx_records:
                    print(f"MX-записи для домена '{domain}': {', 
